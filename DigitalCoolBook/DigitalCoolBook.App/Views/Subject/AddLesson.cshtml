@model DigitalCoolBook.App.Models.CategoryViewModels.CategoryCreateViewModel

@{
    ViewData["Title"] = "AddCategory";
    Layout = "~/Views/Shared/_SubjectDetailLayout.cshtml";
}

<h2>Добавяне на учебни материали</h2>
<hr />
<br />
<div class="row container-fluid">
    <div class="col-md-4">
        <form asp-action="AddLesson" method="post">
            <div class="form-group">
                <div class="col">
                    <label class="gj-font-size-16">Избери Предмет</label>
                    @Html.DropDownListFor(model => model.SubjectId, new SelectList(Model.Subjects, "SubjectId", "Name"), "предмет..", new { @class = "form-control" })
                    @Html.ValidationMessageFor(m => m.SubjectId, "", new { @class = "text-danger" })
                    <div class="row mt-2 ">
                        <a href="/Subject/CreateSubject" class="btn btn-outline-secondary">Добави Предмет</a>
                        <a href="#" id="deleteSubject" class="btn btn-outline-secondary ml-2">Изтрии Предмета</a>
                    </div>
                </div>
            </div>
            <hr />
            <div class="form-group">
                <div class="col">
                    <label class="gj-font-size-16">Избери Раздел</label>
                    @Html.DropDownListFor(model => model.CategoryId, new SelectList(Model.Categories, "Id", "Title"), new { @class = "form-control" })
                    @Html.ValidationMessageFor(m => m.CategoryId, "", new { @class = "text-danger" })
                    <div class="row mt-2">
                        <a href="/Subject/CreateCategory" class="btn btn-outline-secondary">Добави Раздел</a>
                        <a href="#" id="deleteCategory" class="btn btn-outline-secondary ml-2">Изтрии Раздела</a>
                    </div>
                </div>
            </div>
            <hr />
            <div>
                <label for="title" class="gj-font-size-16">Тема</label>
                <input type="text" class="form-control" id="title" name="title" />
                <label for="content" class="gj-font-size-16">Съдържание</label>
                <textarea class="form-control" style="width:850px" id="content" name="content" rows="10"></textarea>
            </div>
            <div class="form-group mt-2">
                <input type="submit" value="Запази" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div id="successMessage"></div>
<div id="errorMessage"></div>

<script>
    // Updates Category according Subject selection
    var categoryDropDown = $('#CategoryId'); // cache variable
    $('#SubjectId').change(function () {
        var SubjectId = $(this).val();
        categoryDropDown.empty(); // clear existing options
        if (!SubjectId) {
            return; // exit if null
        }
        $.ajax({
            type: "POST",
            url: "/Subject/GetCategories",
            data: { subjectId: SubjectId }, // sends subjectId to the action
            success: function (response) {
                categoryDropDown.append($('<option></option>').val('').text('Избери Раздел')); // add a default null option
                $.each(response, function (i, item) {
                    categoryDropDown.append($('<option></option>').val(item.id).text(item.title));
                });
            },
        });
    })

    // Deletes choosen Category
    $(function () {
        $("#deleteCategory").click(function () {
            var categoryId = $('#CategoryId').val();
            $.ajax({
                type: "POST",
                url: "/Subject/DeleteCategory",
                data: { categoryId: categoryId },
                success: function () {
                    $("#successMessage").dialog(
                        {
                            resizable: false,
                            height: 200,
                            width: 300,
                            modal: true,
                            buttons: {
                                "Затвори": function () {
                                    window.location.href = "/Subject/AddLesson",
                                        $(this).dialog("close");
                                }
                            }
                        });
                    $("#successMessage").html("Раздела изтрит!")
                },
                error: function (request, err, message) {
                    $("#errorMessage").html(request.statusText);
                    $("#errorMessage").dialog({
                        maxHeight: 290,
                        width: 600,
                        modal: true,
                        buttons: {
                            "Затвори": function () {
                                $(this).dialog("close");
                            }
                        }
                    });
                }
            })
        })
    })

    // Delete choosen Subject 
    $(function () {
        $("#deleteSubject").click(function () {
            var subjectId = $('#SubjectId').val();
            $.ajax({
                type: "POST",
                url: "/Subject/DeleteSubject",
                data: { subjectId: subjectId },
                success: function () {
                    $("#successMessage").dialog(
                        {
                            resizable: false,
                            height: 200,
                            width: 300,
                            modal: true,
                            buttons: {
                                "Затвори": function () {
                                    window.location.href = "/Subject/AddLesson",
                                        $(this).dialog("close");
                                }
                            }
                        });
                    $("#successMessage").html("Предмета изтрит!")
                },
                error: function (request, err, message) {
                    $("#errorMessage").html(request.statusText);
                    $("#errorMessage").dialog({
                        maxHeight: 290,
                        width: 600,
                        modal: true,
                        buttons: {
                            "Затвори": function () {
                                $(this).dialog("close");
                            }
                        }
                    });
                }
            })
        })
    })
</script>